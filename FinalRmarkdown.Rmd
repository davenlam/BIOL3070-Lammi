---
title: "Final"
author: "Daven Lammi"
date: "`r Sys.Date()`"
output:
  github_document:
  toc: true
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# ABSTRACT

This study looked at the asthma rates for U.S. states from the year 2022, as collected by the CDC. This data was divided among four regions of the U.S.: Northeast, South, North Central, and West. The asthma data for each state, as well as each region, was compared with each state and region's population density. Comparison of this data gave inconclusive results, as there was inconsistency between the population density and asthma rates of the regions. However, there was a substantial difference in population density, as well as asthma prevalence for the Northeast region, when compared to the other regions. Regardless, the ANOVA tests comparing population density and asthma rates were insignificant, thus leaving it inconclusive if population density is a determining factor for asthma prevalence. However, we were able to determine significant difference in asthma rates by region, it is just unclear if population density affects this difference. 

# BACKGROUND

Asthma has immense effects across the world, with 300 million affected individuals worldwide (Kudo, 2013). With the constant growth of urban environments, asthma rates remain on the rise (Lundbäck, 2016). As such a prevalent condition, much data is collected on it each year. However, there are many factors influencing asthma rates, and analysis of asthma data may provide useful insight on which factors are the most impactful. In our research, we aim to discover if there is a difference in asthma prevalence across U.S states and regions (Northeast, South, North Central, West). Additionally, we ask whether this difference may be due to population density. Utilizing information gained from previous research, we expect that states and regions with higher population density and urbanization will have higher rates of asthma.

# STUDY QUESTION and HYPOTHESIS

## Questions  
Do different regions of the U. S vary in asthma prevalence?

## Hypothesis 
We expect that regions that are more densely populated will experience higher rates of asthma due to pollution from large cities.

## Prediction

We predict that states in the Northeast region of the U.S will have higher rates of asthma as they are the most densely populated.

# METHODS
To tackle this question we used data from the CDC which contained asthma rates by state from 2022 (Centers for Disease Control and Prevention, 2024). We compared the asthma rates of the continental U.S. states in a bar graph, sorting them from highest asthma rates to lowest. The data was further visualized in a map of the U.S. showing asthma prevalence across the states. We then moved on to analysis of asthma rates by splitting the states up into four regions: Northeast, South, North Central, and West. The four regions were then displayed in a map of the U.S. Asthma rates were then compared across these regions in a box plot. Furthermore, the role of population density was visualized in a box plot comparing the population densities of the four regions. Additionally, this data was visualized in a scatter plot relating state populations with asthma prevalence. To validate the results of our figures, several ANOVA's were performed.

## Analysis

Bar Graph
```{r setup and data, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

asthma_data <- data.frame(
  state = c("Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut",
            "Delaware","District of Columbia","Florida","Georgia","Hawaii","Idaho","Illinois",
            "Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts",
            "Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada",
            "New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota",
            "Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina",
            "South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington",
            "West Virginia","Wisconsin","Wyoming"),
  
  state_abrv = c("AL","AK", "AZ", "AR", "CA", "CO", "CT", "DE", "DC", "FL", "GA", "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD", "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM", "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC", "SD", "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY"),
  
  number = c(378702,58742,555997,243032,2629546,500090,356651,
             78980,60410,1646583,802783,103228,161970,856488,
             574447,238689,237705,377365,351940,146031,499134,633126,
             935666,434473,211055,497216,102617,121412,251193,
             148330,644536,171212,1611027,764909,61944,
             1042354,373879,389831,1033741,117252,368883,
             56630,636322,1760654,266105,68112,671051,667228,
             181395,503318,46973),
  
  prevalence_raw = c("9.6 (0.59)","10.7 (0.58)","9.7 (0.49)","10.5 (0.57)","8.7 (0.39)","10.8 (0.43)","12.4 (0.51)",
                     "9.9 (0.64)","11.1 (0.77)","9.3 (0.53)","9.6 (0.48)","9.1 (0.45)","11.1 (0.51)","8.7 (0.58)",
                     "11.0 (0.39)","9.7 (0.42)","10.7 (0.41)","10.8 (0.68)","10.0 (0.55)","13.1 (0.52)","10.4 (0.38)","11.3 (0.43)",
                     "11.9 (0.44)","9.9 (0.32)","9.4 (0.63)","10.4 (0.49)","11.7 (0.51)","8.1 (0.46)","10.1 (0.79)",
                     "13.1 (0.64)","8.9 (0.43)","10.4 (0.62)","10.3 (0.34)","9.2 (0.62)","10.4 (0.60)",
                     "11.4 (0.38)","12.3 (0.54)","11.5 (0.51)","10.1 (0.67)","13.3 (0.64)","9.0 (0.40)",
                     "8.3 (0.75)","11.7 (0.61)","7.9 (0.37)","11.0 (0.43)","12.9 (0.53)","9.9 (0.46)","10.9 (0.26)",
                     "12.9 (0.61)","10.9 (0.42)","10.5 (0.65)"), 
  
  population = c(5108468, 733406, 7431344, 3067732, 38965193, 5877610, 3617176, 1031890, 678972,
  22610726, 11029227, 1435138, 1964726, 12549689, 6862199, 3207004, 2940546,
  4526154, 4573749, 1395722, 6180253, 7001399, 10037261, 5737915, 2939690,
  6196156, 1132812, 1978379, 3194176, 1402054, 9290842, 2114371, 19571216,
  10835491, 783926, 11785935, 4053824, 4233358, 12961683, 1095962, 5373555,
  919318, 7126489, 30503301, 3417735, 647464, 8715698, 7812880, 1770071,
  5910955, 584057),
  
   pop_density_sqmile = c(101,1.3,65,59,250,57,747,529,11131,422,192,223,24,226,192,57,36,115,106,45,637,898,178,72,63,90,7.8,26,29,157,1263,17,415,223,11,274,59,44,290,1060,179,12,173,117,42,70,221,118,74,109,6)
)

library(dplyr)
library(stringr)

asthma_data <- asthma_data %>%
  mutate(
    prevalence = as.numeric(str_extract(prevalence_raw, "^[0-9.]+")),
    SE = as.numeric(str_extract(prevalence_raw, "(?<=\\().+?(?=\\))")),
    state_lower = tolower(state),
    region = state.region[match(state, state.name)]
  )

asthma_data <- na.omit(asthma_data)

region_data <- data.frame(
  region = c("North Central", "Northeast", "South", "West" ),
  density = c(107, 549, 204, 60),
  prevalence = c(10.1, 11.7, 10.2, 10.6))



```


```{r plot-state-data, echo=FALSE, message=FALSE, warning=FALSE, fig.height=10, fig.width=7}
# Load required libraries
library(tidyverse)

# Create the plot
ggplot(asthma_data, aes(x = reorder(state, prevalence), y = prevalence, fill= region)) +
  geom_col() +
  geom_errorbar(aes(ymin = prevalence - SE, ymax = prevalence + SE), width = 0.3) +
  coord_flip() +
  labs(
    title = "Asthma Rates by State ",
    x = "State",
    y = "Rate (%)",
    fill = "Region" ) +
  theme_minimal(base_size = 12) +
  theme(
    axis.text.y = element_text(size = 10, margin = margin(r = 5)),
    plot.margin = margin(10, 15, 10, 15)
  )


```

Bar graph comparing asthma rates by state; the Northeast takes the top spots but much variation is observed.


Red to Yellow State Asthma Prevalence Map
```{r prevalence by state, include=TRUE, eval=TRUE, warning=FALSE, fig.align='center', fig.width=6, fig.height=3}
# Load libraries
library(ggplot2)

library(ggplot2)
library(maps)
library(dplyr)

# Map data
states_map <- map_data("state")

# Merge map data with asthma data
map_data <- states_map %>%
  left_join(asthma_data, by = c("region" = "state_lower"))

ggplot(map_data, aes(long, lat, group = group, fill = prevalence)) +
  geom_polygon(color = "gray90", size = 0.3) +  # state borders
  geom_polygon(aes(fill = prevalence), color = "white") +
  coord_fixed(1.3) +
 scale_fill_gradientn(
  name = "Asthma Prevalence (%)",
  colors = c("yellow2", "orange", "red", "red4")
) +
  labs(
    title = "Asthma Prevalence by U.S. State",
  ) +
  theme_void() +
  theme(
    legend.position = "right",
    plot.title = element_text(size = 16, face = "bold"),
    plot.subtitle = element_text(size = 12)
  )

```

Map showing asthma rates for the continental U.S. states; The Northeast takes the top spots but much variation is observed.


State Regions Map
```{r regions by color}
#just regions
# Get U.S. states map data
states_map <- map_data("state")

# Create a dataframe of states and their regions
state_regions <- data.frame(
  state = tolower(state.name),
  region = state.region
)

# Merge map data with region info
map_data <- states_map %>%
  left_join(state_regions, by = c("region" = "state"))

# Plot
ggplot(map_data, aes(x = long, y = lat, group = group, fill = region.y)) +
  geom_polygon(color = "white") +
  coord_fixed(1.3) +
  labs(title = "Four U.S. Census Regions",
       fill = "Region") +
  theme_void()
```

Map of the U.S. showing how regions were split up.


State Regions and Asthma Prevalence Box Plot
```{r box plot, include=TRUE, eval=TRUE, warning=FALSE, fig.align='center', fig.width=4.75, fig.height=7}

library(ggplot2)

ggplot(asthma_data, aes(x = region, y = prevalence, fill= region)) +
  geom_boxplot() +
  labs(title = "Asthma Prevalence by U.S. Region",
       x = "Region",
       y = "Asthma Prevalence (%)",
       fill = "Region") +
  theme_minimal()

```

Box plot showing higher asthma prevalence in the Northeast; other regions have little variation.


State Regions and Population Density Box Plot
```{r box plot population vs region, include=TRUE, eval=TRUE, warning=FALSE, fig.align='center', fig.width=4.75, fig.height=7}

library(ggplot2)

ggplot(asthma_data, aes(x = region, y = pop_density_sqmile, fill= region)) +
  geom_boxplot() +
  labs(title = "Population Density by U.S. Region",
       x = "Region",
       y = "Population Density (square mile)",
       fill = "Region") +
  theme_minimal()

```

Box plot showing higher population density in the Northeast; other regions have little variation.


State Population vs Prevalence Scatter Plot
```{r scatter plot, include=TRUE, eval=TRUE, warning=FALSE, fig.align='center'}

ggplot(asthma_data, aes(x = population, y = prevalence)) +
  geom_point(aes(color=region)) +
  geom_text(aes(label = state_abrv), vjust = -0.5, size = 3)+
  labs(title = "Population vs. Asthma Prevalence by State",
       x = "Population",
       y = "Asthma Prevalence (%)",
       color = "Regions") +
  theme_minimal()
```

Scatter plot showing much variation between state population and asthma prevalence.


ANOVA Test for population density and prevalence
```{r first analysis ANOVA for state population density and asthma prevalence, eval=FALSE}

# load necessary libraries

library("car")
library("lme4")

# create a linear model for population density per square mile and asthma prevalence by state

m1 <- lm(prevalence ~ pop_density_sqmile, data=asthma_data)

# perform statistical test

Anova(m1)
summary(m1)

```

ANOVA test for region and prevalence, pairwise comparison
```{r second analysis ANOVA by region and pairwise comparison, eval= FALSE}

# load necessary libraries

library(emmeans)

# create a linear model for US region and asthma prevalence

m2 <- lm(prevalence ~ region, data=asthma_data) 

# perform statistical test 

Anova(m2) 
summary(m2)


# pairwise comparison

pairs(emmeans(m2, "region"))

```

ANOVA test for population density and asthma prevalence by region
```{r third analysis ANOVA for region population density and asthma prevalence, eval=FALSE}

# create a linear model for average population density per region and asthma prevalence

r1 <- lm(prevalence ~ density, data=region_data)

# perform statistical test

Anova(r1)
summary(r1)

```


# DISCUSSION
  In the bar plot displaying asthma rates by state, the 4 out of the 5 states with highest asthma rates belonged to the Northeast region. Besides this however, there was much variation across the order of the states. This implies that while there may be a trend of higher asthma rates in some of the Northeast states, there is too much variation to be sure. Looking at the map of asthma rates by state we see a similar trend, with the states with the highest rates being in the Northeast, but variation among the other states. Moving along to the box plot displaying asthma prevalence by U.S. regions, we clearly see higher rates in the Northeast region, but the North Central, South, and West have much smaller variation between them. Looking at the box plot showing population density by region, the Northeast has the highest average population density, while the other three regions do not have immense variation between them. Taking the results of both box plots, we see that the region with the highest asthma rates also has the highest population density. However, it is unclear if the population density among the North Central, South, and West regions impacts asthma rates. This is due to there being little variation among these regions, as well as the variation existing does not match between population density and asthma rates. Looking at the scatter plot comparing state population to asthma rates, there is much variation, making it difficult to make concrete conclusions.
  Looking at the ANOVA test for population density and asthma prevalence by state, a p-value of 0.6668 was found. Due to this p-value being much higher than 0.05, we are not able to determine a significant connected between population density and asthma prevalence between states. For the ANOVA test for U.S. regions and asthma prevalence, a p-value of 0.0192 was calculated. Due to this value being lower than 0.05, we are able to determine a significant difference between asthma prevalence by region. Lastly, the ANOVA test relating population density and asthma prevalence by region resulted in a p-value of 0.1293. Due to this p-value being higher than 0.05, we are not able to determine a significant relationship between population density and asthma prevalence by state.
  Using this information, we are able to determine that while there is a significant difference in asthma prevalence by region, it is inconclusive if this difference is due to population density. However, although no significance was determined, the Northeast was both the highest in population density and in asthma prevalence, which does support the hypothesis. However, due to inconsistent variation among the other regions for population density and asthma rates, as well as failure to determine significance, it remain unclear if population density is a influential factor. 


# CONCLUSION
  Looking at the results of both the box plot comparing asthma prevalence by region, as well as the box plot comparing population density by region, the Northeast is considerably higher than the other regions among both plots. This supports our hypothesis that states and regions with higher population density will have higher rates of asthma. However, this trend did not continue with the other regions, as there was little variation for the population density and the asthma prevalence box plots. Additionally, the ANOVA tests relating population density and asthma prevalence both at the state and regions levels produced insignificant results. Due to this it remains unclear if population density is an important factor in predicting asthma rates either by state or region. It additionally becomes irrelevant that the Northeast is the highest in both population density and asthma rates,  as the ANOVA failed to produce significant results. 
  However, we were able to determine that the difference in asthma rates between regions was significant, just not likely due to population density. This difference could be due to a variety of factors, such as age, sex, or race. Further research considering these factors may produce more conclusive results.
  Additionally, there is some uncertainty in the validity of our results, as the data we analyzed was only from 2022. This prevents us from accounting for year-by-year variation in asthma rates among the states. To improve upon this in future studies, it may be beneficial to analyze data across many years. This would lead to a more accurate depiction of asthma rates by state, instead of the limited snapshot used in this analysis. 


# REFERENCES     
1. Centers for Disease Control and Prevention. (2024, November 21). Most recent asthma data. U.S. Department of Health and Human Services. 

2. Kudo, M., Ishigatsubo, Y., & Aoki, I. (2013). Pathology of asthma. Frontiers in microbiology, 4, 263.

3. Lundbäck, B., Backman, H., Lötvall, J., & Rönmark, E. (2016). Is asthma prevalence still increasing?. Expert review of respiratory medicine, 10(1), 39-51.

4. ChatGPT. OpenAI, version Jan 2025. Used as a reference for functions such as plot() and to correct syntax errors. Accessed `r Sys.Date()`.


