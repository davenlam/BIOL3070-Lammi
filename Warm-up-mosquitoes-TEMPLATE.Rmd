---
title: "Warm-up mini-Report: Mosquito Blood Hosts in \n Salt Lake City, Utah"
author: "Daven Lammi"
date: "`r Sys.Date()`"
output:
  github_document:
    toc: true
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# ABSTRACT

This report investigates the role of House Finches (Haemorhous mexicanus) as amplifying hosts of West Nile virus (WNV) in Salt Lake City. Blood meal data from various sites were collected to determine the relationship between birds, mosquitoes, and WNV. Bar plots of days of viremia revealed that House Finches contain detectable WNV in their bloodstream for the longest period of time, which increases their ability to spread the virus. Linear models showed that the likelihood of WNV-positive mosquito pools and rate of WNV positivity both increased significantly with the number of House Finch blood meals. These results suggest that House Finches are important amplifying hosts that contribute to WNV spread in the Salt Lake area.

# BACKGROUND

According to the CDC, thousands of Americans get infected with West Nile Virus(WNV) a year, with many experiencing severe illness or even death (1). As the infection is transmitted through mosquitoes, there us risk of infection throughout the entirety of the US due to their widespreadness. The mosquitoes themselves become infected by feeding on infected birds. Due to this, many efforts have been made to understand where this disease makes contact with humans along all levels of transmission, as shown by the research efforts of Kumar et al., 2003 (2). In this study, they allowed 25 species of birds to become infected with WNV and monitored them, including their viremia duration. The results of the viremia length can be visualized by the code below. From the resulting figure it can be seen that there is much variability in the days of detectable viremia across the various species. However, there were also some clear species that had longer lengths, such as house finches. Due to this, house finches may be a large risk for transmission of WNV. If this were the case, it would be expected that locations with higher populations of house finches would also have higher positive tests for WNV in mosquito pools. 


```{r viremia, include=TRUE, eval=TRUE, warning=FALSE, fig.align='left', fig.width=4.75, fig.height=7}
# Manually transcribe duration (mean, lo, hi) from the last table column
duration <- data.frame(
  Bird = c("Canada Goose","Mallard", 
           "American Kestrel","Northern Bobwhite",
           "Japanese Quail","Ring-necked Pheasant",
           "American Coot","Killdeer",
           "Ring-billed Gull","Mourning Dove",
           "Rock Dove","Monk Parakeet",
           "Budgerigar","Great Horned Owl",
           "Northern Flicker","Blue Jay",
           "Black-billed Magpie","American Crow",
           "Fish Crow","American Robin",
           "European Starling","Red-winged Blackbird",
           "Common Grackle","House Finch","House Sparrow"),
  mean = c(4.0,4.0,4.5,4.0,1.3,3.7,4.0,4.5,5.5,3.7,3.2,2.7,1.7,6.0,4.0,
           4.0,5.0,3.8,5.0,4.5,3.2,3.0,3.3,6.0,4.5),
  lo   = c(3,4,4,3,0,3,4,4,4,3,3,1,0,6,3,
           3,5,3,4,4,3,3,3,5,2),
  hi   = c(5,4,5,5,4,4,4,5,7,4,4,4,4,6,5,
           5,5,5,7,5,4,3,4,7,6)
)

# Choose some colors
cols <- c(rainbow(30)[c(10:29,1:5)])  # rainbow colors

# horizontal barplot
par(mar=c(5,12,2,2))  # wider left margin for names
bp <- barplot(duration$mean, horiz=TRUE, names.arg=duration$Bird,
              las=1, col=cols, xlab="Days of detectable viremia", xlim=c(0,7))

# add error bars
arrows(duration$lo, bp, duration$hi, bp,
       angle=90, code=3, length=0.05, col="black", xpd=TRUE)
```

# STUDY QUESTION and HYPOTHESIS

## Questions  
In this study we want to learn which bird species pose the highest threat to the spread of WNV in Salt Lake City, UT.

## Hypothesis 
House Finches are expected to be a threat to the spread of WNV in Salt Lake City, UT by acting as amplifying hosts.
  
## Prediction
If house finches are the biggest threat to the spread of WNV, we predict that there will be a positive correlation between the number of house finches in the mosquito feeding trapping locations and the rates of confirmed WNV in the mosquito pools.

# METHODS
To test this hypothesis, we created bar plots which compared the number of mosquito blood meals for various species in locations with no detected WNV and locations with detected WNV. This allows us to see if mosquito blood meals are disproportionate across either category. For additional analysis, a linear model was calculated to determine the strength of the relationship between the number of house finch blood meals and the presence of WNV-positive pools and rates. This allows us to know if house finch blood meals can predict if there will be WNV infections.

# Barplots of blood meal ID by trap locations with/without WNV positive mosquito pools

Horizontal plots:
```{r horiz-plot,fig.align='left',fig.width=7,fig.height=7, warning=FALSE}
## import counts_matrix: data.frame with column 'loc_positives' (0/1) and host columns 'host_*'
counts_matrix <- read.csv("./bloodmeal_plusWNV_for_BIOL3070.csv")

## 1) Identify host columns
host_cols <- grep("^host_", names(counts_matrix), value = TRUE)

if (length(host_cols) == 0) {
  stop("No columns matching '^host_' were found in counts_matrix.")
}

## 2) Ensure loc_positives is present and has both levels 0 and 1 where possible
counts_matrix$loc_positives <- factor(counts_matrix$loc_positives, levels = c(0, 1))

## 3) Aggregate host counts by loc_positives
agg <- stats::aggregate(
  counts_matrix[, host_cols, drop = FALSE],
  by = list(loc_positives = counts_matrix$loc_positives),
  FUN = function(x) sum(as.numeric(x), na.rm = TRUE)
)

## make sure both rows exist; if one is missing, add a zero row
need_levels <- setdiff(levels(counts_matrix$loc_positives), as.character(agg$loc_positives))
if (length(need_levels)) {
  zero_row <- as.list(rep(0, length(host_cols)))
  names(zero_row) <- host_cols
  for (lv in need_levels) {
    agg <- rbind(agg, c(lv, zero_row))
  }
  ## restore proper type
  agg$loc_positives <- factor(agg$loc_positives, levels = c("0","1"))
  ## coerce numeric host cols (they may have become character after rbind)
  for (hc in host_cols) agg[[hc]] <- as.numeric(agg[[hc]])
  agg <- agg[order(agg$loc_positives), , drop = FALSE]
}

## 4) Decide species order (overall abundance, descending)
overall <- colSums(agg[, host_cols, drop = FALSE], na.rm = TRUE)
host_order <- names(sort(overall, decreasing = TRUE))
species_labels <- rev(sub("^host_", "", host_order))  # nicer labels

## 5) Build count vectors for each panel in the SAME order
counts0 <- rev(as.numeric(agg[agg$loc_positives == 0, host_order, drop = TRUE]))
counts1 <- rev(as.numeric(agg[agg$loc_positives == 1, host_order, drop = TRUE]))

## 6) Colors: reuse your existing 'cols' if it exists and is long enough; otherwise generate
if (exists("cols") && length(cols) >= length(host_order)) {
  species_colors <- setNames(cols[seq_along(host_order)], species_labels)
} else {
  species_colors <- setNames(rainbow(length(host_order) + 10)[seq_along(host_order)], species_labels)
}

## 7) Shared x-limit for comparability
xmax <- max(c(counts0, counts1), na.rm = TRUE)
xmax <- if (is.finite(xmax)) xmax else 1
xlim_use <- c(0, xmax * 1.08)

## 8) Plot: two horizontal barplots with identical order and colors
op <- par(mfrow = c(1, 2),
          mar = c(4, 12, 3, 2),  # big left margin for species names
          xaxs = "i")           # a bit tighter axis padding

## Panel A: No WNV detected (loc_positives = 0)
barplot(height = counts0,
        names.arg = species_labels, 
        cex.names = .5,
        cex.axis = .5,
        col = rev(unname(species_colors[species_labels])),
        horiz = TRUE,
        las = 1,
        xlab = "Bloodmeal counts",
        main = "Locations WNV (-)",
        xlim = xlim_use)

## Panel B: WNV detected (loc_positives = 1)
barplot(height = counts1,
        names.arg = species_labels, 
        cex.names = .5,
        cex.axis = .5,
        col = rev(unname(species_colors[species_labels])),
        horiz = TRUE,
        las = 1,
        xlab = "Bloodmeal counts",
        main = "Locations WNV (+)",
        xlim = xlim_use)

par(op)

## Keep the colors mapping for reuse elsewhere
host_species_colors <- species_colors
```
This analysis visualizes blood meal counts for various bird species across locations with and without WNV-positive pools, allowing for comparison between them.

## Linear Regression
```{r second-analysis-or-plot, include=TRUE, eval=TRUE, warning=FALSE, fig.align='left', fig.width=4.75, fig.height=7}
# put code for plotting here
```
```{r}
# second-analysis-or-plot, glm with house finch alone against binary +/_
glm1 <- glm(loc_positives ~ host_House_finch,
            data = counts_matrix,
            family = binomial)
summary(glm1)

#glm with house-finch alone against positivity rate
glm2 <- glm(loc_rate ~ host_House_finch,
            data = counts_matrix)
summary(glm2)
```
This analysis performs linear regressions which allows us to determine if house finch blood meals can predict WNV-positive pools and rates.

# DISCUSSION

## Interpretation - fill in analysis
Through the bar plot analysis of blood meal counts among various species between locations with and without WNV-positive pools, we found that the locations with WNV-positive pools had disproportionately higher blood meal counts for house finches when compared to the locations with no WNV-positive pools. This suggests that house finches are a key source of infection for mosquitoes and thus become amplifying hosts by causing more mosquitoes to feed on them which transmits WNV to other species.

## Interpretation - fill in analysis/plot
Through the linear regression analysis we first found that the coefficient for the relationship between house finch blood meals and WNV-positive pools was 0.3468 with p value of 0.0287. Since this value is positive, this means that an increase of of house finch blood meals predicts an increase in WNV-positive pools. Additionally, with the low p-value of 0.0287, these results are statistically significant.
The second analysis done with linear regression measured the relationship between house finch blood meals and WNV positivity rate. The coefficient from this analysis was 0.0275 with a p-value of 4.54e05. The positive value of 0.0275 implies that an increase in house finch blood meals predicts an increase in WNV positivity rate, and the low p-value of 4.54e05 makes this value statistically significant.
These analyses together imply that house finches are acting as amplifying hosts which is contributing to the spread of WNV in Salt Lake City.

# CONCLUSION
Through our analyses we found that house finches appear to be a large contributing factor to the spread of WNV in Salt Lake City by acting as amplifying hosts. The bar plot comparison of house finch blood meals between locations with and without WNV-positive pools allowed us to see that house finches are feasted on disproportionately more in WNV-positive locations. This shows that house finches amplify mosquito populations and help spread WNV. Additionally we found through the linear regression analysis that house finch blood meal counts positively predict an increase in WNV-positive pools and rates, with coefficients of 0.3468 and 0.0275 respectively. Overall, these findings support our hypothesis that house finches are a threat to the spread of WNV by acting as amplifying hosts. A limitation to this design however is that we may only have data from a small period of time, which only reflects the state of house finch-mosquito dynamics at that point in time. A more precise and accurate depiction of this relationship could come from collecting data for many years, which would make sure that the data is not biased by an abnormal year. 

# REFERENCES     

1. Centers for Disease Control and Prevention. About West Nile [Internet]. West Nile Virus. 2024. Available from: https://www.cdc.gov/west-nile-virus/about/index.html

2. Komar N, Langevin S, Hinten S, Nemeth N, Edwards E, Hettler D, Davis B, Bowen R, Bunning M. Experimental infection of North American birds with the New York 1999 strain of West Nile virus. Emerg Infect Dis. 2003 Mar;9(3):311-22. https://doi.org/10.3201/eid0903.020628

3. ChatGPT. OpenAI, version Jan 2025. Used as a reference for functions such as plot() and to correct syntax errors. Accessed `r Sys.Date()`.


